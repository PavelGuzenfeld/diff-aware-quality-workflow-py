name: Release

on:
  push:
    branches: [main]
  release:
    types: [published]

permissions:
  contents: write
  id-token: write
  attestations: write

jobs:
  release:
    if: github.event_name == 'push'
    uses: ./.github/workflows/auto-release.yml
    with:
      enable_provenance: true
    secrets:
      app_id: ${{ secrets.RELEASE_APP_ID }}
      app_private_key: ${{ secrets.RELEASE_APP_PRIVATE_KEY }}

  version-sync:
    if: github.event_name == 'release'
    uses: ./.github/workflows/version-sync.yml
    with:
      tag: ${{ github.event.release.tag_name }}
      enable_pyproject: true
    secrets:
      app_id: ${{ secrets.RELEASE_APP_ID }}
      app_private_key: ${{ secrets.RELEASE_APP_PRIVATE_KEY }}
