name: Release

on:
  push:
    branches: [main]
  release:
    types: [published]

permissions:
  contents: write
  id-token: write
  attestations: write

jobs:
  release:
    if: github.event_name == 'push'
    uses: ./.github/workflows/auto-release.yml
    with:
      enable_provenance: true

  version-sync:
    if: github.event_name == 'release'
    uses: ./.github/workflows/version-sync.yml
    with:
      tag: ${{ github.event.release.tag_name }}
      enable_pyproject: true
